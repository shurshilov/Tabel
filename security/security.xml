<openerp>
    <data>
        <record id="group_manager" model="res.groups">
            <field name="name">Tabel / Admin</field>
        </record>
        <record id="group_tabel_calendar" model="res.groups">
            <field name="name">Tabel / view tabel calendar</field>
        </record>



        <record id="group_import" model="res.groups">
            <field name="name">Tabel / Import</field>
        </record>

        <record id="boss_division_inf" model="res.groups">
            <field name="name">Tabel / Начальник отдела (отделения)</field>
        </record> 

        <record id="tabel_division_inf" model="res.groups">
            <field name="name">Tabel / Табельщик отдела (отделения)</field>
        </record>
        <record id="done_division_inf" model="res.groups">
            <field name="name">Tabel / Исполнитель отдела (отделения)</field>
        </record>
        <record id="group_accountant" model="res.groups">
            <field name="name">Tabel / Бухгалтер</field>
        </record>
        <record id="group_eco" model="res.groups">
            <field name="name">Tabel / Экономисты</field>
        </record>

<!--	ADMIN -->
	<record id="admin_rule" model="ir.rule">
            <field name="name">Админ читает,изменяет,создает табели любых статусов и подразделений</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('group_manager'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                [ (1,'=',1) ]
            </field>
        </record>

<!--	BOSS INF -->
	<record id="bos3" model="ir.rule">
            <field name="name">Нач. отдела изменяет и читает все 'confirmed' и только своего отдела</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('boss_division_inf'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                [  ('state','not in',['draft','confirmed2','done']),('id_division.id','in', [(emp.id) for emp in user.ids_division]) ]
            </field>
        </record>

	<record id="bos2" model="ir.rule">
            <field name="name">Нач. отдела читает все табели своих отделов</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('boss_division_inf'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="0"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                [ ('state','in',['draft','confirmed2','done']),('id_division.id','in', [(emp.id) for emp in user.ids_division]) ]
            </field>
        </record>

<!--	TABEL_DIVISION_INF -->
	<record id="inf3" model="ir.rule">
            <field name="name">Табельщик имеет все действия с 'draft' документами которые он создал или создал админ(0)</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('tabel_division_inf'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="1"/>
            <field name="perm_unlink" eval="1"/>
            <field name="domain_force">
		[('state','not in',['confirmed','confirmed2','done']),('create_uid' ,'in',[user.id,0])]
<!--                [('state','not in',['confirmed','confirmed2','done']),('id_division.id','in', [(emp.id) for emp in user.ids_division])] -->
            </field>
        </record>


	<record id="inf2" model="ir.rule">
            <field name="name">Табельщик читает все документы с остальными статусами но только те котоые он создал или админ(0)</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('tabel_division_inf'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
		[('state','in',['confirmed','confirmed2','done']),('create_uid' ,'in',[user.id,0])]
	<!--	 [('state','in',['confirmed','confirmed2','done']),('id_division.id','in', [(emp.id) for emp in user.ids_division])] -->
	    </field>
        </record>

<!--	ACCOUNTANT              	[('id_division.id','like', user.ids_division)]    [('state','in',['confirmed','confirmed2','done']),('id_division.id','in', [( emp.id ) for emp in user.ids_division])]-->


	<record id="accountant" model="ir.rule">
            <field name="name">Only Responsible can modify Course</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('group_accountant'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                ['|', ('state','=','confirmed2'),
                      ('state','=','done')]
            </field>
        </record>
<!--
	<record id="accountant rule 2" model="ir.rule">
            <field name="name">Правило для бухгалтера подписывать только свои табели</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('group_accountant'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                [ ('state','not in',['confirmed','done']) ]
	    </field>
        </record> -->


	<record id="accountant rule 1" model="ir.rule">
            <field name="name">Правило для бухгалтера видеть все табели</field>
            <field name="model_id" ref="model_tabel_tabel"/>
            <field name="groups" eval="[(4, ref('group_accountant'))]"/>
            <field name="perm_read" eval="1"/>
            <field name="perm_write" eval="1"/>
            <field name="perm_create" eval="0"/>
            <field name="perm_unlink" eval="0"/>
            <field name="domain_force">
                ['|', ('state','=','draft'),
                      ('state','=','confirmed')]
	    </field>
        </record>

    </data>
</openerp>


